<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "Tools & Calculators" }}</title>
  <meta name="description" content="Atom Economy, PMI, E-factor and sustainability calculators for green chemistry." />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <!-- Header -->
  <header class="bg-white border-b">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
      <a class="flex items-center gap-2" href="/">
        <div class="h-8 w-8 rounded-xl bg-emerald-600"></div>
        <span class="text-xl font-semibold">Green Toolkit</span>
      </a>
      <nav class="flex gap-4 text-sm">
        <a class="hover:text-emerald-700" href="/">Home</a>
        <a class="text-emerald-700 font-medium" href="/tools">Tools</a>
        <a class="hover:text-emerald-700" href="/simulate">Simulations</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-10">
    <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-2">Tools & Calculators</h1>
    <p class="text-gray-600 mb-8">Quick calculators to estimate sustainability metrics for reactions.</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Atom Economy -->
      <section class="rounded-2xl bg-white p-6 shadow-sm border">
        <h2 class="text-xl font-semibold mb-2">Atom Economy</h2>
        <p class="text-sm text-gray-600 mb-4">AE = (MW of desired product) / (Σ MW of reactants) × 100</p>
        <form id="ae-form" class="grid gap-3 max-w-md" novalidate>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Product MW (g/mol)</span>
            <input id="ae_prod_mw" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 180.16"/>
          </label>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Total Reactants MW (g/mol)</span>
            <input id="ae_react_total" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 240.21"/>
          </label>
          <div class="flex items-center gap-3 mt-2">
            <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2 text-white text-sm font-medium hover:bg-emerald-700">Calculate</button>
            <span id="ae-output" class="text-sm text-gray-800 hidden"><strong>AE:</strong> <span id="ae-value">—</span> %</span>
          </div>
          <p id="ae-error" class="text-sm text-red-600 mt-2 hidden"></p>
        </form>
      </section>

      <!-- E-factor (Total-in) -->
      <section class="rounded-2xl bg-white p-6 shadow-sm border">
        <h2 class="text-xl font-semibold mb-2">E-factor</h2>
        <p class="text-sm text-gray-600 mb-4">E = (Total mass in − Product mass) / Product mass</p>
        <form id="ef-form" class="grid gap-3 max-w-md" novalidate>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Total mass in (g)</span>
            <input id="ef_total_in" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 30"/>
          </label>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Product mass (g)</span>
            <input id="ef_prod_mass" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 10"/>
          </label>
          <div class="flex items-center gap-3 mt-2">
            <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2 text-white text-sm font-medium hover:bg-emerald-700">Calculate</button>
            <span id="ef-output" class="text-sm text-gray-800 hidden"><strong>E-factor:</strong> <span id="ef-value">—</span></span>
          </div>
          <p id="ef-error" class="text-sm text-red-600 mt-2 hidden"></p>
        </form>
      </section>

      <!-- PMI -->
      <section class="rounded-2xl bg-white p-6 shadow-sm border">
        <h2 class="text-xl font-semibold mb-2">PMI (Process Mass Intensity)</h2>
        <p class="text-sm text-gray-600 mb-4">PMI = Total mass in / Product mass</p>
        <form id="pmi-form" class="grid gap-3 max-w-md" novalidate>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Total mass in (g)</span>
            <input id="pmi_total_in" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 30"/>
          </label>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Product mass (g)</span>
            <input id="pmi_prod_mass" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 10"/>
          </label>
          <div class="flex items-center gap-3 mt-2">
            <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2 text-white text-sm font-medium hover:bg-emerald-700">Calculate</button>
            <span id="pmi-output" class="text-sm text-gray-800 hidden"><strong>PMI:</strong> <span id="pmi-value">—</span></span>
          </div>
          <p id="pmi-error" class="text-sm text-red-600 mt-2 hidden"></p>
        </form>
      </section>

      <!-- Water Impact -->
      <section class="rounded-2xl bg-white p-6 shadow-sm border">
        <h2 class="text-xl font-semibold mb-2">Water Usage</h2>
        <p class="text-sm text-gray-600 mb-4">Outputs L per g and L per kg of product</p>
        <form id="water-form" class="grid gap-3 max-w-md" novalidate>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Total water used (L)</span>
            <input id="water_liters" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 2"/>
          </label>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Product mass (g)</span>
            <input id="water_prod_mass" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 10"/>
          </label>
          <div class="flex items-center gap-3 mt-2">
            <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2 text-white text-sm font-medium hover:bg-emerald-700">Calculate</button>
            <span id="water-output" class="text-sm text-gray-800 hidden"><strong>L/g:</strong> <span id="water-lpg">—</span> • <strong>L/kg:</strong> <span id="water-lpk">—</span></span>
          </div>
          <p id="water-error" class="text-sm text-red-600 mt-2 hidden"></p>
        </form>
      </section>

      <!-- Energy Impact -->
      <section class="rounded-2xl bg-white p-6 shadow-sm border">
        <h2 class="text-xl font-semibold mb-2">Energy Use</h2>
        <p class="text-sm text-gray-600 mb-4">Outputs kWh per g and kWh per kg of product</p>
        <form id="energy-form" class="grid gap-3 max-w-md" novalidate>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Total energy used (kWh)</span>
            <input id="energy_kwh" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 0.5"/>
          </label>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Product mass (g)</span>
            <input id="energy_prod_mass" type="number" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 10"/>
          </label>
          <div class="flex items-center gap-3 mt-2">
            <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2 text-white text-sm font-medium hover:bg-emerald-700">Calculate</button>
            <span id="energy-output" class="text-sm text-gray-800 hidden"><strong>kWh/g:</strong> <span id="energy-kwhg">—</span> • <strong>kWh/kg:</strong> <span id="energy-kwhk">—</span></span>
          </div>
          <p id="energy-error" class="text-sm text-red-600 mt-2 hidden"></p>
        </form>
      </section>

      <!-- RME -->
      <section class="rounded-2xl bg-white p-6 shadow-sm border" id="rme">
        <h2 class="text-xl font-semibold mb-2">RME (Reaction Mass Efficiency)</h2>
        <p class="text-sm text-gray-600 mb-4"><span class="font-medium">Formula:</span> RME = (Product mass) / (Σ Reactant masses) × 100</p>
        <form id="rme-form" class="grid gap-3 max-w-md" novalidate>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Reactant masses (g, comma-separated)</span>
            <input type="text" id="rme_reactants" class="border rounded-lg px-3 py-2" placeholder="e.g., 8.3, 12.2" />
          </label>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Product mass (g)</span>
            <input type="number" id="rme_product" step="any" min="0" class="border rounded-lg px-3 py-2" placeholder="e.g., 10" />
          </label>
          <div class="flex items-center gap-3 mt-2">
            <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2 text-white text-sm font-medium hover:bg-emerald-700">Calculate</button>
            <span id="rme-output" class="text-sm text-gray-800 hidden"><strong>RME:</strong> <span id="rme-value">—</span> %</span>
          </div>
          <p id="rme-error" class="text-sm text-red-600 mt-2 hidden"></p>
        </form>
      </section>

      <!-- Carbon Efficiency -->
      <section class="rounded-2xl bg-white p-6 shadow-sm border" id="carbon-efficiency">
        <h2 class="text-xl font-semibold mb-2">Carbon Efficiency</h2>
        <p class="text-sm text-gray-600 mb-4">% of carbon atoms from reactants that end up in the product.</p>
        <form id="ce-form" class="grid gap-3 max-w-md" novalidate>
          <fieldset class="grid gap-2 border rounded p-3">
            <legend class="text-sm font-medium px-1">Product</legend>
            <input class="border rounded px-3 py-2" id="ce_p_mass" type="number" step="any" min="0" placeholder="mass g">
            <input class="border rounded px-3 py-2" id="ce_p_mw"   type="number" step="any" min="0" placeholder="MW g/mol">
            <input class="border rounded px-3 py-2" id="ce_p_c"    type="number" step="1"   min="0" placeholder="carbon atoms">
          </fieldset>
          <fieldset class="grid gap-2 border rounded p-3">
            <legend class="text-sm font-medium px-1">Reactants (comma-separated triplets)</legend>
            <input class="border rounded px-3 py-2" id="ce_r_list" placeholder="mass_g:mw:carbon_atoms, e.g., 8.3:138.12:7, 12.2:102.09:4">
          </fieldset>
          <div class="flex items-center gap-3">
            <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2 text-white text-sm font-medium hover:bg-emerald-700">Calculate</button>
            <span id="ce-output" class="text-sm text-gray-800 hidden"><strong>Carbon Efficiency:</strong> <span id="ce-value">—</span> %</span>
          </div>
          <p id="ce-error" class="text-sm text-red-600 mt-2 hidden"></p>
        </form>
      </section>

      <!-- Stoichiometric Factor -->
      <section class="rounded-2xl bg-white p-6 shadow-sm border" id="stoichiometric-factor">
        <h2 class="text-xl font-semibold mb-2">Stoichiometric Factor</h2>
        <p class="text-sm text-gray-600 mb-4">Overall SF = (Σ equivalents used) / (Σ stoichiometric equivalents required)</p>
        <form id="sf-form" class="grid gap-3 max-w-md" novalidate>
          <label class="grid gap-1">
            <span class="text-sm text-gray-700">Species (comma-separated triples name:eq_used:eq_stoich)</span>
            <input id="sf_list" class="border rounded-lg px-3 py-2" placeholder="e.g., salicylic acid:1.0:1.0, acetic anhydride:1.2:1.0">
          </label>
          <div class="flex items-center gap-3">
            <button type="submit" class="rounded-xl bg-emerald-600 px-4 py-2 text-white text-sm font-medium hover:bg-emerald-700">Calculate</button>
            <span id="sf-output" class="text-sm text-gray-800 hidden"><strong>Overall SF:</strong> <span id="sf-value">—</span></span>
          </div>
          <p id="sf-error" class="text-sm text-red-600 mt-2 hidden"></p>
        </form>
      </section>

    </div>
  </main>

  <footer class="mt-12 border-t">
    <div class="mx-auto max-w-6xl px-4 py-6 text-xs text-gray-500">
      © <span id="year"></span> Green Toolkit • Tools & Calculators
    </div>
  </footer>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Atom Economy
    (function(){
      const f = document.querySelector('#ae-form'); if(!f) return;
      const out = document.querySelector('#ae-output'), val = document.querySelector('#ae-value'), err = document.querySelector('#ae-error');
      f.addEventListener('submit', async (e)=>{
        e.preventDefault(); err.classList.add('hidden');
        const mw_product = Number(document.querySelector('#ae_prod_mw').value);
        const mw_reactants_total = Number(document.querySelector('#ae_react_total').value);
        if(!(mw_product>0 && mw_reactants_total>0)) { err.textContent='Enter positive product MW and total reactants MW.'; err.classList.remove('hidden'); return; }
        const res = await fetch('/api/atom-economy',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({mw_product, mw_reactants_total})});
        const data = await res.json();
        if(!res.ok){ err.textContent=data.detail||'Server error'; err.classList.remove('hidden'); return; }
        val.textContent = Number(data.atom_economy_pct).toFixed(2); out.classList.remove('hidden');
      });
    })();

    // E-factor
    (function(){
      const f = document.querySelector('#ef-form'); if(!f) return;
      const out = document.querySelector('#ef-output'), val = document.querySelector('#ef-value'), err = document.querySelector('#ef-error');
      f.addEventListener('submit', async (e)=>{
        e.preventDefault(); err.classList.add('hidden');
        const total_mass_in = Number(document.querySelector('#ef_total_in').value);
        const product_mass = Number(document.querySelector('#ef_prod_mass').value);
        if(!(total_mass_in>=0 && product_mass>0)) { err.textContent='Enter total mass in (>=0) and product mass (>0).'; err.classList.remove('hidden'); return; }
        const res = await fetch('/api/e-factor',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({total_mass_in, product_mass})});
        const data = await res.json();
        if(!res.ok){ err.textContent=data.detail||'Server error'; err.classList.remove('hidden'); return; }
        val.textContent = Number(data.e_factor).toFixed(4); out.classList.remove('hidden');
      });
    })();

    // PMI
    (function(){
      const f = document.querySelector('#pmi-form'); if(!f) return;
      const out = document.querySelector('#pmi-output'), val = document.querySelector('#pmi-value'), err = document.querySelector('#pmi-error');
      f.addEventListener('submit', async (e)=>{
        e.preventDefault(); err.classList.add('hidden');
        const total_mass_in = Number(document.querySelector('#pmi_total_in').value);
        const product_mass = Number(document.querySelector('#pmi_prod_mass').value);
        if(!(total_mass_in>0 && product_mass>0)) { err.textContent='Enter positive total mass in and product mass.'; err.classList.remove('hidden'); return; }
        const res = await fetch('/api/pmi',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({total_mass_in, product_mass})});
        const data = await res.json();
        if(!res.ok){ err.textContent=data.detail||'Server error'; err.classList.remove('hidden'); return; }
        val.textContent = Number(data.pmi).toFixed(4); out.classList.remove('hidden');
      });
    })();

    // Water
    (function(){
      const f = document.querySelector('#water-form'); if(!f) return;
      const out = document.querySelector('#water-output'), lpg = document.querySelector('#water-lpg'), lpk = document.querySelector('#water-lpk'), err = document.querySelector('#water-error');
      f.addEventListener('submit', async (e)=>{
        e.preventDefault(); err.classList.add('hidden');
        const water_liters = Number(document.querySelector('#water_liters').value);
        const product_mass_g = Number(document.querySelector('#water_prod_mass').value);
        if(!(water_liters>=0 && product_mass_g>0)) { err.textContent='Enter water (>=0) and product mass (>0).'; err.classList.remove('hidden'); return; }
        const res = await fetch('/api/water-impact',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({water_liters, product_mass_g})});
        const data = await res.json();
        if(!res.ok){ err.textContent=data.detail||'Server error'; err.classList.remove('hidden'); return; }
        lpg.textContent = Number(data.liters_per_g).toFixed(4);
        lpk.textContent = Number(data.liters_per_kg).toFixed(2);
        out.classList.remove('hidden');
      });
    })();

    // Energy
    (function(){
      const f = document.querySelector('#energy-form'); if(!f) return;
      const out = document.querySelector('#energy-output'), kwhg = document.querySelector('#energy-kwhg'), kwhk = document.querySelector('#energy-kwhk'), err = document.querySelector('#energy-error');
      f.addEventListener('submit', async (e)=>{
        e.preventDefault(); err.classList.add('hidden');
        const kwh = Number(document.querySelector('#energy_kwh').value);
        const product_mass_g = Number(document.querySelector('#energy_prod_mass').value);
        if(!(kwh>=0 && product_mass_g>0)) { err.textContent='Enter kWh (>=0) and product mass (>0).'; err.classList.remove('hidden'); return; }
        const res = await fetch('/api/energy-impact',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({kwh, product_mass_g})});
        const data = await res.json();
        if(!res.ok){ err.textContent=data.detail||'Server error'; err.classList.remove('hidden'); return; }
        kwhg.textContent = Number(data.kwh_per_g).toFixed(6);
        kwhk.textContent = Number(data.kwh_per_kg).toFixed(4);
        out.classList.remove('hidden');
      });
    })();

    // RME
    (function(){
      const form = document.querySelector('#rme-form'); if (!form) return;
      const out = document.querySelector('#rme-output'), val = document.querySelector('#rme-value'), err = document.querySelector('#rme-error');
      form.addEventListener('submit', async (e)=>{
        e.preventDefault(); err.classList.add('hidden');
        const masses = (document.querySelector('#rme_reactants').value||'')
          .split(',').map(s=>Number(s.trim())).filter(n=>Number.isFinite(n) && n>=0);
        const product_mass_g = Number(document.querySelector('#rme_product').value);
        if (!masses.length || !(product_mass_g>0)) { err.textContent='Enter reactant masses and product mass (>0).'; err.classList.remove('hidden'); return; }
        const res = await fetch('/api/rme', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({reactant_masses_g:masses, product_mass_g})});
        const data = await res.json();
        if (!res.ok){ err.textContent=data.detail||'Error calculating RME.'; err.classList.remove('hidden'); return; }
        val.textContent = Number(data.rme_pct).toFixed(2); out.classList.remove('hidden');
      });
    })();

    // Carbon Efficiency
    (function(){
      const form = document.querySelector('#ce-form'); if (!form) return;
      const out = document.querySelector('#ce-output'), val = document.querySelector('#ce-value'), err = document.querySelector('#ce-error');
      form.addEventListener('submit', async (e)=>{
        e.preventDefault(); err.classList.add('hidden');
        const product = {
          mass_g: Number(document.querySelector('#ce_p_mass').value),
          mw: Number(document.querySelector('#ce_p_mw').value),
          carbon_atoms: Number(document.querySelector('#ce_p_c').value)
        };
        const reactants = (document.querySelector('#ce_r_list').value||'').split(',')
          .map(s=>s.trim()).filter(Boolean).map(t=>{
            const [mass_g, mw, carbon_atoms] = t.split(':').map(Number);
            return {mass_g, mw, carbon_atoms};
          });
        if (!(product.mass_g>=0 && product.mw>0 && product.carbon_atoms>=0) || !reactants.length){
          err.textContent='Provide product (mass, MW, carbon atoms) and at least one reactant triplet.'; err.classList.remove('hidden'); return;
        }
        const res = await fetch('/api/carbon-efficiency',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({product, reactants})});
        const data = await res.json();
        if (!res.ok){ err.textContent=data.detail||'Error calculating Carbon Efficiency.'; err.classList.remove('hidden'); return; }
        val.textContent = Number(data.carbon_efficiency_pct).toFixed(2); out.classList.remove('hidden');
      });
    })();

    // Stoichiometric Factor
    (function(){
      const form = document.querySelector('#sf-form'); if (!form) return;
      const out = document.querySelector('#sf-output'), val = document.querySelector('#sf-value'), err = document.querySelector('#sf-error');
      form.addEventListener('submit', async (e)=>{
        e.preventDefault(); err.classList.add('hidden');
        const species = (document.querySelector('#sf_list').value||'').split(',')
          .map(s=>s.trim()).filter(Boolean).map(t=>{
            const [name, eu, es] = t.split(':'); return {name, eq_used:Number(eu), eq_stoich:Number(es)};
          });
        if (!species.length){ err.textContent='Provide at least one species triple.'; err.classList.remove('hidden'); return; }
        const res = await fetch('/api/stoichiometric-factor',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({species})});
        const data = await res.json();
        if (!res.ok){ err.textContent=data.detail||'Error calculating SF.'; err.classList.remove('hidden'); return; }
        val.textContent = Number(data.sf_overall).toFixed(4); out.classList.remove('hidden');
      });
    })();
  </script>
</body>
</html>
